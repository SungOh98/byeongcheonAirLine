<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="./css/seat.css" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
      body {
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .container {
        display: grid;
        grid-template-columns: repeat(10, 1fr);
        grid-template-rows: repeat(20, 1fr);
        gap: 10px;
        width: 500px;
        height: 800px;
      }

      .container div {
        border: 1px solid gray;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
      }

      .group1 {
        background-color: lightblue;
      }

      .group2 {
        background-color: lightgreen;
      }

      .group3 {
        background-color: lightyellow;
      }

      .selected {
        background-color: lightgray;
      }

      #title {
        text-align: center;
        font-size: 24px;
        margin-bottom: 20px;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background-color: white;
        padding: 10px;
      }

      #seat-info {
        margin-left: 20px;
        margin-top: 10px;
        font-size: 16px;
        text-align: center;
      }

      #seat-info div {
        margin-bottom: 5px;
      }

      #reserve-button {
        margin-left: 30px;
        display: flex;
        justify-content: center;
      }
    </style>
  </head>
  <body>
    <h1 id="title">좌석 예약</h1>

    <div class="container">
      <script>
        // 선택한 사각형의 번호를 저장하는 변수
        let selectedNumber = null;

        // 사각형 클릭 이벤트 핸들러
        function handleSquareClick(number) {
          // 선택한 사각형의 번호를 업데이트
          selectedNumber = number;

          // 모든 사각형에서 선택된 스타일 제거
          const squares = document.querySelectorAll(".container div");
          squares.forEach((square) => square.classList.remove("selected"));

          // 선택한 사각형에 선택된 스타일 추가
          const selectedSquare = document.querySelector(
            `.container div[data-number="${number}"]`
          );
          selectedSquare.classList.add("selected");

          // 좌석 등급 및 가격 정보 출력
          const seatInfoElement = document.getElementById("seat-info");
          const seatClassElement = document.getElementById("class");
          const seatPriceElement = document.getElementById("price");

          if (number >= 1 && number <= 10) {
            seatClassElement.textContent = "퍼스트";
            seatPriceElement.textContent = selectedSquare.getAttribute("price");
          } else if (number >= 11 && number <= 50) {
            seatClassElement.textContent = "비즈니스";
            seatPriceElement.textContent = selectedSquare.getAttribute("price");
          } else {
            seatClassElement.textContent = "이코노미";
            seatPriceElement.textContent = selectedSquare.getAttribute("price");
          }
        }

        // 예약 버튼 클릭 이벤트 핸들러
        function handleReserveButtonClick() {
          if (selectedNumber) {
            const seatInfoElement = document.getElementById("seat-info");
            const seatInfo = seatInfoElement.innerHTML;
            const seatInfoElement2 = document.getElementById("class");
            const seatClass = seatInfoElement2.innerHTML;
            const seatInfoElement3 = document.getElementById("price");
            const seatPrice = seatInfoElement3.innerHTML;

            console.log("좌석 번호:", selectedNumber);
            console.log("좌석 등급:", seatClass);
            console.log("좌석 가격:", seatPrice);
          } else {
            console.log("좌석을 선택해주세요.");
          }
        }

        // JSON 데이터를 가져오는 함수
        function fetchSeats(flightId) {
          const url = `http://172.19.83.23:8080/seats/${flightId}`; // IP주소 수정
          axios
            .get(url)
            .then((response) => {
              // 받아온 JSON 데이터 처리
              handleSeatData(response.data);
            })
            .catch((error) => {
              console.log("Error:", error);
            });
        }

        function handleSeatData(data) {
          const reservedSeats = data.reservedSeats;
          const seatPrice = data.seatPrice;

          // 좌석 예약 여부 확인 및 번호 표시
          const squares = document.querySelectorAll(".container div");
          squares.forEach((square) => {
            const seatNumber = parseInt(square.getAttribute("data-number"));
            if (reservedSeats.find((seat) => seat.id === seatNumber)) {
              square.textContent = "X";
            }

            // 좌석 등급에 따라 가격 업데이트
            if (seatNumber >= 1 && seatNumber <= 10) {
              square.setAttribute("price", seatPrice.first);
              console.log(square);
            } else if (seatNumber >= 11 && seatNumber <= 50) {
              square.setAttribute("price", seatPrice.business);
            } else {
              square.setAttribute("price", seatPrice.economy);
            }
          });
        }

        // 페이지 로드 시 좌석 데이터 가져오기
        window.onload = function () {
          const flightId = 969; // 예시로 flightId를 1로 설정, 선택한 항공편에 있는 flightId로 수정 필요
          fetchSeats(flightId);
        };

        for (let i = 1; i <= 200; i++) {
          const div = document.createElement("div");
          div.textContent = i;
          div.setAttribute("data-number", i);
          div.addEventListener("click", () => handleSquareClick(i));

          if (i >= 1 && i <= 10) {
            div.classList.add("group1");
          } else if (i >= 11 && i <= 50) {
            div.classList.add("group2");
          } else {
            div.classList.add("group3");
          }

          document.querySelector(".container").appendChild(div);
        }
      </script>
    </div>

    <div id="seat-info">
      <div>좌석 등급:</div>
      <div id="class">좌석 가격:</div>
      <div id="price"></div>
    </div>

    <div id="reserve-button">
      <button onclick="handleReserveButtonClick()">예약</button>
    </div>
  </body>
</html>
