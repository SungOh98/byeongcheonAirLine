<!DOCTYPE html>
<html>
  <head>
    <title>티켓 조회(회원)</title>
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="./css/ticket.css" />
    <link rel="stylesheet" href="./css/header.css" />
  </head>
  <style>
    .ticket {
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
    }
  </style>
  <header class="my-header">
    <div class="container">
      <div class="top-header">
        <div class="header">
          <div class="logo"><a href="index.html">BCAirline</a></div>
          <div class="button-group" id="login-buttons">
            <!-- 로그인 버튼 -->
            <a href="login.html" class="btn btn-primary">로그인</a>
            <a href="member_form.html" class="res-button">회원가입</a>
          </div>
          <div class="button-group" id="account-info" style="display: none;">
            <!-- 로그인 상태 표시 -->
            <span id="loggedInAccount"></span>
            <a href="logout.html" id="logoutButton" class="btn btn-secondary">로그아웃</a>
          </div>
        </div>
      </div>
      <nav class="navbar navbar-expand-lg bg-light">
        <div class="container-fluid">
          </button>
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item"></li>
            <li><a class="nav-link" href="ticket_search_customer.html">티켓 조회(비회원)</a></li>
            <li><a class="nav-link" href="ticket_search_member.html">티켓 조회(회원)</a></li>
          </ul>
          </li>
        </form>
        </div>
      </div>
    </nav>
  </div>
  </header>

  <body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <div class="container">
      <h2>티켓 조회(회원)</h2>
      <div>
        <input type="text" id="accountInput" placeholder="아이디" />
        <input type="password" id="passwordInput" placeholder="패스워드" />
        <button onclick="searchTicket()">검색</button>
      </div>
      <div id="ticketList"></div>
    </div>

    <script>
    // 티켓 조회 함수
    function searchTicket() {
  const accountInput = document.getElementById("accountInput").value;
  const passwordInput = document.getElementById("passwordInput").value;
  const accessToken = sessionStorage.getItem("accessToken");
  const config = {
    headers: {
      "access-token": accessToken
    }
  };

  axios
          .get(`http://192.168.137.1:8080/tickets/member?account=${accountInput}&password=${passwordInput}`, config)
          .then(function (response) {
            const tickets = response.data.tickets;
            console.log(tickets);
            console.log(tickets.length);
            const ticketList = document.getElementById("ticketList");
            ticketList.innerHTML = ""; // 기존 내용 지우기

            if (tickets.length > 0) {
              tickets.forEach(function (ticket) {
                const ticketDiv = document.createElement("div");
                ticketDiv.classList.add("ticket");
                ticketDiv.id = `ticket-${ticket.id}`; // 고유한 ID 부여

                // 티켓 번호
                const ticketNumber = document.createElement("p");
                ticketNumber.textContent = `티켓 번호: ${ticket.id}`;
                ticketDiv.appendChild(ticketNumber);

                // 출발지
                const departure = document.createElement("p");
                departure.textContent = `출발지: ${ticket.departure}`;
                ticketDiv.appendChild(departure);

                // 도착지
                const arrival = document.createElement("p");
                arrival.textContent = `도착지: ${ticket.arrival}`;
                ticketDiv.appendChild(arrival);

                // 출발 시간
                const departureTime = document.createElement("p");
                departureTime.textContent = `출발 시간: ${ticket.departureTime}`;
                ticketDiv.appendChild(departureTime);

                // 도착 시간
                const arrivalTime = document.createElement("p");
                arrivalTime.textContent = `도착 시간: ${ticket.arrivalTime}`;
                ticketDiv.appendChild(arrivalTime);

                // 좌석 등급
                const seatClass = document.createElement("p");
                seatClass.textContent = `좌석 등급: ${ticket.seatClass}`;
                ticketDiv.appendChild(seatClass);

                // 항공기
                const planeName = document.createElement("p");
                planeName.textContent = `항공기: ${ticket.planeName}`;
                ticketDiv.appendChild(planeName);

                // 좌석 번호
                const seatId = document.createElement("p");
                seatId.textContent = `좌석 번호: ${ticket.seatId}`;
                ticketDiv.appendChild(seatId);

                // 티켓 상태
                const state = document.createElement("p");
        state.className = `state ${ticket.state}`;
        state.textContent =
          ticket.state === "reserved"
            ? "예약됨"
            : ticket.state === "canceled"
            ? "취소됨"
            : "사용됨";
                ticketDiv.appendChild(state);

                ticketList.appendChild(ticketDiv);
              });
            } else {
              ticketList.textContent = "티켓이 없습니다.";
            }
          })
          .catch(function (error) {
            console.log(error);
          });
      }
      // 로그인 상태 확인 함수
      function checkLoginStatus() {
        const loginButtons = document.getElementById("login-buttons");
        const accountInfo = document.getElementById("account-info");
        const loggedInAccount = document.getElementById("loggedInAccount");
        const logoutButton = document.getElementById("logoutButton");
        const account = sessionStorage.getItem("loggedInAccount");

        if (account) {
          // 로그인 상태인 경우
          loginButtons.style.display = "none";
          accountInfo.style.display = "block";
          loggedInAccount.textContent = "로그인된 계정: " + account;
        } else {
          // 로그인 상태가 아닌 경우
          loginButtons.style.display = "block";
          accountInfo.style.display = "none";
          loggedInAccount.textContent = "";
        }
      }

      // 로그아웃 버튼 클릭 이벤트 처리
      function logout() {
        sessionStorage.removeItem("loggedInAccount");
        checkLoginStatus();
      }

      // 페이지 로드 시 로그인 상태 확인
      checkLoginStatus();

      // 로그아웃 버튼 클릭 이벤트 연결
       logoutButton = document.getElementById("logoutButton");
      logoutButton.addEventListener("click", logout);

    </script>
  </body>
</html>