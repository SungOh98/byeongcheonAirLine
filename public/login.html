<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="./css/login.css" />
    <title>로그인</title>
  </head>
  <body>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <div class="login-container">
      <h2>로그인</h2>
      <form id="login-form">
        <input
          type="text"
          placeholder="아이디"
          name="account"
          id="account"
          required
        />
        <br />
        <input
          type="password"
          placeholder="비밀번호"
          name="password"
          id="password"
          required
        />
        <br />
        <button type="submit">로그인</button>
      </form>
    </div>
    <script>
      function handleSubmit(event) {
        event.preventDefault();
        let account = document.getElementById("account").value;
        let password = document.getElementById("password").value;
        let member = {
          account: account,
          password: password,
        };

        const serverURL = "http://172.19.83.53:8080/member/login";
        axios
          .post(serverURL, member)
          .then((response) => {
            console.log("Member information sent successfully!");

            // 로그인 성공 시 accessToken, refreshToken 저장
            const accessToken = response.data["access-token"];
            const refreshToken = response.data["refresh-token"];

            sessionStorage.setItem("accessToken", accessToken);
            sessionStorage.setItem("refreshToken", refreshToken);
            sessionStorage.setItem("loggedInAccount", account); // 입력받은 아이디를 세션에 저장

            const access_session = sessionStorage.getItem("accessToken");
            const refresh_session = sessionStorage.getItem("refreshToken");
            const account_session = sessionStorage.getItem("loggedInAccount");
            console.log(`Access Token:`, access_session);
            console.log(`Refresh Token:`, refresh_session);
            console.log("account : ", account_session);

            // 페이지 이동
            window.location.href = "index.html";
          })
          .catch((error) => {
            console.error("Error sending member information:", error);
            // 로그인이 실패한 경우 알림창으로 실패 메시지 표시
            alert("로그인에 실패했습니다.");
          });

        event.target.reset();
      }

      // 로그인 폼 제출 이벤트 리스너 등록
      let form = document.getElementById("login-form");
      form.addEventListener("submit", handleSubmit);
    </script>
  </body>
</html>
