<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>승객 조회</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" type="text/css" href="./css/header.css" />
    <link rel="stylesheet" type="text/css" href="./css/member_form.css" />
  </head>
  <body>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- 상단에 로고, 회원가입, Navbar 부분-->
    <header class="my-header">
      <div class="container">
        <div class="top-header">
          <div class="header">
            <div class="logo"><a href="index.html">BCAirline</a></div>
            <div class="button-group" id="login-buttons">
              <!-- 로그인 버튼 -->
              <a href="login.html" class="btn btn-primary">로그인</a>
              <a href="member_form.html" class="res-button">회원가입</a>
            </div>
            <div class="button-group" id="account-info" style="display: none;">
              <!-- 로그인 상태 표시 -->
              <span id="loggedInAccount"></span>
              <a href="logout.html" id="logoutButton" class="btn btn-secondary">로그아웃</a>
            </div>
          </div>
        </div>
      </div>
    </header>

    <!-- 정보 입력하는 부분 -->
    <div class="container">
      <div class="outer">
        <div class="summit-form">
          <div class="contents">
            <form class="container" id="signup-form">
              <div class="col">
                <label for="enLastName" class="form-label">영문 성</label>
                <input type="text" class="form-control" id="enLastName" required />
              </div>
              <div class="col">
                <label for="enFirstName" class="form-label">영문 이름</label>
                <input type="text" class="form-control" id="enFirstName" required />
              </div>
              <div class="col">
                <label for="birthday" class="form-label">생년월일 (YYYY-MM-DD.)</label>
                <input type="text" class="form-control" id="birthday" required />
              </div>
              <div class="col">
                <label for="sex" class="form-label">성별</label>
                <div>
                  <input
                    type="radio"
                    class="form-check-input"
                    id="sexMale"
                    name="sex"
                    value="남자"
                    required
                  />
                  <label class="form-check-label" for="sexMale">남자</label>
                </div>
                <div>
                  <input
                    type="radio"
                    class="form-check-input"
                    id="sexFemale"
                    name="sex"
                    value="여자"
                    required
                  />
                  <label class="form-check-label" for="sexFemale">여자</label>
                </div>
              </div>
              <div class="col">
                <label for="email" class="form-label">이메일 주소</label>
                <input type="email" class="form-control" id="email" required />
              </div>
              <div class="col">
                <label for="phone" class="form-label">핸드폰 번호</label>
                <input type="phone" class="form-control" id="phone" required />
              </div>
              <div class="col">
                <label for="validationDefault13" class="form-label">거주국가</label>
                <select class="form-select" id="nation" required>
                  <option selected value="Korea (the Republic of)">Korea (the Republic of)</option>
                  <option>EK</option>
                  <option>USA</option>
                  <option>China</option>
                  <option>Japan</option>
                </select>
              </div>
              <div class="form-group">
                <input
                  type="submit"
                  value="좌석 선택"
                  onclick="handleSubmit(event)"
                />
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <script>
      function handleSubmit(event) {
        event.preventDefault();
        let enLastName = document.getElementById("enLastName").value;
        let enFirstName = document.getElementById("enFirstName").value;
        let birthday = document.getElementById("birthday").value;
        let sex = document.querySelector('input[name="sex"]:checked').value;
        let email = document.getElementById("email").value;
        let phone = document.getElementById("phone").value;
        let nation = document.getElementById("nation").value;

        // Get flightId from sessionStorage
        let flightData = JSON.parse(sessionStorage.getItem("flightData"));
        let flightId = flightData.flights[0].flightId; // Assuming the flightId is from the first flight in the array

        let customer = {
            enLastName: enLastName,
            enFirstName: enFirstName,
            email: email,
            birthday: birthday,
            sex: sex,
            phone: phone,
            nation: nation,
            flightId: flightId // Insert the flightId into customerInfo
        };

        // Store customerInfo in sessionStorage
        sessionStorage.setItem("customerInfo", JSON.stringify(customer));

        // Redirect to seat.html with flightId query parameter
        window.location.href = `seat.html?flightId=${flightId}`;
        }



      // 회원가입 폼 제출 이벤트 리스너 등록
      let form = document.getElementById("signup-form");
      form.addEventListener("submit", handleSubmit);

      // 로그인 상태 확인 함수
      function checkLoginStatus() {
        var loginButtons = document.getElementById("login-buttons");
        var accountInfo = document.getElementById("account-info");
        var loggedInAccount = document.getElementById("loggedInAccount");
        var logoutButton = document.getElementById("logoutButton");
        var account = sessionStorage.getItem("loggedInAccount");

        if (account) {
          // 로그인 상태인 경우
          loginButtons.style.display = "none";
          accountInfo.style.display = "block";
          loggedInAccount.textContent = "로그인된 계정: " + account;
          logoutButton.addEventListener("click", logout);
        } else {
          // 비로그인 상태인 경우
          loginButtons.style.display = "block";
          accountInfo.style.display = "none";
        }
      }

      // 로그아웃 함수
      function logout() {
        sessionStorage.removeItem("loggedInAccount");
        location.reload();
      }

      // 페이지 로드 시 로그인 상태 확인
      window.addEventListener("DOMContentLoaded", checkLoginStatus);
    </script>
  </body>
</html>
